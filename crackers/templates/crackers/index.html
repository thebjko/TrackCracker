{% extends 'base.html' %}

{% block content %}
<h1>Objectives</h1>
<p>Click Objective Title to See Subtask or Create One.</p>
<table class="table table-hover">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Objective</th>
      <th scope="col">Achievement</th>
      <th scope="col">Completed</th>
      <th scope="col">Duration</th>
      <th scope="col">Buttons</th>
    </tr>
  </thead>
  <tbody>
    {% for objective in objectives %}
    {% widthratio objective.achievement 1 100 as width %}
    <tr>
      <th scope="row">{{ objective.pk }}</th>
      {% if objective.tasks.exists %}
      <td>
        <button hx-get="{% url 'tracks:detail' objective.pk %}" hx-target=".offcanvas-body" hx-swap="innerHTML" class="btn btn-link btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">{{ objective.title }}</button>
      </td>
      {% else %}
      <td>
        <button class="btn btn-sm" hx-get="{% url 'tracks:create_task' objective.pk %}" hx-target="body" hx-confirm="There's no related subtask. Create one now.">
          {{ objective.title }}
        </button>
      </td>
      {% endif %}
      <td>
        <div class="progress" role="progressbar" aria-label="objective-achievement" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
          <div class="progress-bar bg-info text-body" style="width: {{ width }}%">{{ width }}% Achieved</div>
        </div>
      </td>
      <td><p class="btn btn-sm">{{ objective.completed }}(체크박스 또는 hx)</p></td>
      <td><p class="btn btn-sm">{{ objective.duration }}</p></td>
      <td>
        <a class="btn btn-primary btn-sm"
          hx-delete="{% url 'tracks:delete' objective.pk %}"
          hx-confirm="Are you sure to delete this objective? This will delete all related subtasks.">Delete</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<a href="{% url 'tracks:create' %}">Create Objective</a>
{% endblock content %}
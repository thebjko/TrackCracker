{% extends 'base.html' %}

{% block content %}
<h1>{{ title }}</h1>
<form action="{{ action }}" method="post">
  <input type="hidden" name="_path" value={{ path }}>
  {% csrf_token %}
  {% with form.title as title %}
  <div class="form-group my-3">
    <label for="{{ title.id_for_label }}">{{ title.label }}</label>
    <input autofocus required type="{{ title.field.widget.input_type }}" class="form-control" placeholder="{{ title.label }}" name="{{ title.name }}" />
  </div>
  {% endwith %}
  
  {% with form.description as description %}
  <div class="form-group my-3">
    <label for="{{ description.id_for_label }}">{{ description.label }}</label>
    <textarea id="{{ description.id_for_label }}" class="form-control" placeholder="{{ description.label }}" name="{{ description.name }}"></textarea>
  </div>
  {% endwith %}
  
  {% with form.proportion as proportion %}
  <label for="{{ proportion.id_for_label }}">{{ proportion.label }}</label>
  {% if supertask and supertask.accumulative %}
  <p class="my-1 mb-0 text-danger">ëˆ„ì ê°’ìœ¼ë¡œ ì…ë ¥ì¤‘ì…ë‹ˆë‹¤. ëˆ„ì ê°’ ì…ë ¥ì„ ì›í•˜ì§€ ì•Šìœ¼ì‹œë©´ ìƒìœ„íƒœìŠ¤í¬ì—ì„œ ëˆ„ì ê°’ ì…ë ¥ ì—¬ë¶€ë¥¼ í•´ì œí•˜ì„¸ìš”.</p>
  {% endif %}
  <div class="input-group mt-0 mb-3">
    <input id="{{ proportion.id_for_label }}" required type="{{ proportion.field.widget.input_type }}" class="form-control" placeholder="{{ proportion.label }}" name="{{ proportion.name }}" />
    <button class="btn btn-outline-primary" type="button" id="sexagesimal-to-decimal-btn-proportion" data-input-id="{{ proportion.id_for_label }}">60ì§„ìˆ˜ë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ê¸°</button>
  </div>
  {% endwith %}
  
  {% with form.accumulative as accumulative %}
  <div class="form-check">
    <label class="form-check-label" for="{{ accumulative.id_for_label }}">{{ accumulative.label }}</label>
    <input class="form-check-input" type="{{ accumulative.field.widget.input_type }}" name="{{ accumulative.name }}" id="{{ accumulative.id_for_label }}">
    <p class="my-1">ì²´í¬í•˜ì‹œë©´, ì˜ˆë¥¼ ë“¤ì–´, ì±…ì˜ ì§„í–‰ë¥ ì„ ì…ë ¥í•  ë•Œ, ì´ì „ ì±•í„°ì˜ í˜ì´ì§€ë¥¼ ëº„ í•„ìš” ì—†ì´ ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <p class="my-1 mb-3">ex. ì±•í„° 1 â†’ 35pgê¹Œì§€, ì±•í„° 2 â†’ 60pgê¹Œì§€ì¸ ê²½ìš°, ì±•í„° 1ì— 35, ì±•í„° 2ì— 25ë¥¼ ì…ë ¥í•  í•„ìš” ì—†ì´ ê·¸ëŒ€ë¡œ 35, 60ìœ¼ë¡œ ì…ë ¥ê°€ëŠ¥.</p>
  </div>
  {% endwith %}
  
  {% with form.start as start %}
  <div id="div-{{ start.id_for_label }}" class="d-none mb-3 mt-0">
    <label for="{{ start.id_for_label }}">{{ start.label }} ğŸ‘ˆ ì„œë¸ŒíƒœìŠ¤í¬ì˜ ë¹„ì¤‘ì„ ëˆ„ì ìœ¼ë¡œ ì…ë ¥í•˜ëŠ” ê²½ìš°, ì‹œì‘ì ì„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</label>
    <p class="my-1 mb-3">ì˜ˆë¥¼ ë“¤ì–´, 36í˜ì´ì§€ë¶€í„° ì‹œì‘í•˜ëŠ” ì±•í„° 2ì˜ ì„œë¸ŒíƒœìŠ¤í¬ë¥¼ ë§Œë“¤ ë•Œ, ì‹œì‘ì ì„ 36ìœ¼ë¡œ ì…ë ¥í•˜ì‹œë©´ 40í˜ì´ì§€ê¹Œì§€ì¸ ì„¹ì…˜ 2.1, 50í˜ì´ì§€ê¹Œì§€ì¸ 2.2, 60í˜ì´ì§€ê¹Œì§€ì¸ 2.3ì˜ ë¹„ì¤‘ì„ ê³„ì‚°í•  í•„ìš” ì—†ì´ ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <div class="input-group">
      <input id="{{ start.id_for_label }}" required type="{{ start.field.widget.input_type }}" class="form-control" placeholder="{{ start.label }}" name="{{ start.name }}" value="0" />
      <button class="btn btn-outline-primary" type="button" id="sexagesimal-to-decimal-btn-start" data-input-id="{{ start.id_for_label }}">60ì§„ìˆ˜ë¥¼ 10ì§„ìˆ˜ë¡œ ë³€í™˜í•˜ê¸°</button>
    </div>
  </div>
  {% endwith %}

  <button class="btn btn-primary" type="submit">CREATE</button>
</form>
<script>
  const accumulative = document.getElementById('{{ form.accumulative.id_for_label }}')
  const start = document.getElementById('div-{{ form.start.id_for_label }}')
  accumulative.addEventListener('click', (e) => {
    start.classList.toggle('d-none')
  })
  const converterBtns = document.querySelectorAll('[id^=sexagesimal-to-decimal-btn]')
  converterBtns.forEach((btn) => {
    btn.addEventListener('click', (e) => {
      console.log(btn.dataset.inputId)
      const sexagesimalInput = document.querySelector(`input#${btn.dataset.inputId}`)
      console.log(sexagesimalInput)
      let inputValue = Number(sexagesimalInput.value)
      console.log(inputValue)
      let convertedValue = 0
      let power = 0
      let flag = true
      while (inputValue) {
        const mod = inputValue % 100
        if (mod >= 60) {
          flag = false
          alert('ì˜¬ë°”ë¥¸ 60ì§„ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\nex. 5ì‹œê°„ 15ë¶„ 23ì´ˆ â†’ 51523')
          break
        }
        convertedValue += mod * Math.pow(60, power)
        inputValue = Math.floor(inputValue/100)
        power ++
      }
      if (flag) {
        const temp = sexagesimalInput.value
        sexagesimalInput.value = convertedValue
        alert(`${temp}ì—ì„œ ${convertedValue}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`)
      }
    })
  })
  {% comment %} converterBtn.addEventListener('click', (e) => {
    const proportionInput = document.getElementById('{{ form.proportion.id_for_label }}')
    let inputValue = Number(proportionInput.value)
    let convertedValue = 0
    let power = 0
    let flag = true
    while (inputValue) {
      const mod = inputValue % 100
      if (mod >= 60) {
        flag = false
        alert('ì˜¬ë°”ë¥¸ 60ì§„ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\nex. 5ì‹œê°„ 15ë¶„ 23ì´ˆ â†’ 51523')
        break
      }
      convertedValue += mod * Math.pow(60, power)
      inputValue = Math.floor(inputValue/100)
      power ++
    }
    if (flag) {
      const temp = proportionInput.value
      proportionInput.value = convertedValue
      alert(`${temp}ì—ì„œ ${convertedValue}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`)
    }
  }) {% endcomment %}
</script>
{% endblock content %}